## Модуль сессий обмена с платформой
Путь импорта модуля: `baseline.session`  
Отвечает за управление сессиями обмена эпикризами с платформой.  
Работает в асинхронном режиме, т.е. запускает event loop и вс.
На данным момент взаимодействие с платформой построено на протоколе websocket, конкретно используется надстройка над протоколом - socketio.  
В зависимостях модуля:
- [python-socketio["asyncio-client"]](https://python-socketio.readthedocs.io/en/latest/api.html#socketio.AsyncClient)
- [aiohttp](https://docs.aiohttp.org/en/stable/)

Для начала работы с сессиями необходимо указать токен участника (TOKEN) в файле `.env` из корня проекта. Токен можно получить в ЛК участника платформы Про\\чтение.  
Так же предусмотрен дебаг режим, активируется при помощи переменной окружения `DEBUG` в файле `.env` из корня проекта.  
В дебаг режиме выводится более детальный лог работы обмена и формируется файла `logs/debug_{time}.log` в который пишутся сериализованные сообщения .

Реализованы абстракция подключения к платформе `baseline.session.connector.session_connector_abstract` и стандартная реализация `baseline.session.connector.session_websocket_connector`.  
Вся логика работы с протоколом обмена и инициализации разметки полученного эссе вынесена в коннектор
В случае необходимости реализации своего коннектора, необходимо наследоваться от абстрактного коннектора и придерживаться протокола обмена с платформой, после заменить в `SessionConnectorFactory` вызываемый класс.  
[Протокол обмена с платформой](session-protocol.md)

Точка входа в модуль это класс Session который предоставляет интерфейс для:
- старта сессии, с параметрами старта
- отмены сессии
- реконнекта к активной сессии
- отправки файла решения в ходе сессии

Когда, в рамках сессии обмена, приходит файл эссе, происходит асинхронный вызов Модуля Решения, на вход которого передается полученный эпикриз, а как результат ожидается решение.  
Как только решение было составлено и возвращено управление в коннектор, происходит отправка результата на платформу.

#### Краткое описание процесса сессии
1) При установке коннекта с платформой, происходит автоматическая проверка на наличие активной сессии и подключение в неё, если таковая имеется.  
    После подключения к сессии, клиент ожидает события доступности файла.  
2) Когда файла эссе становится доступным, в сообщении этого события приходит весь контент файла. 
    Получив файл, создается объект эпикриза (`Epicrisis`), и его содержимое сохраняется на диск в директорию `files/sessions/{session_id}/input`, имя файла строится из id файла и расширения xml.  
3) После сохранения файла управление передается в модуль разметки, конкретная реализация способа разметки проводит необходимые операции над файлом.
4) Модуль разметки возвращает результат в модуль сессии, который отправляет результат на платформу.
5) После передачи всех файлов сессия останавливает передавая соответствующий сигнал клиенту, после чего происходит дисконнект с платформой.